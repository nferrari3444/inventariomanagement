{% extends '_base.html' %}

<head>
{% load static %}

</head>

{% block content %}
<!-- sm:col-span-2 -->
<section class="bg-white dark:bg-gray-900">
    <div class="py-8 px-4 mx-auto max-w-3xl lg:py-16">
        <h2 class="mb-4 text-xl font-bold text-gray-900 dark:text-white">Ingreso de Nuevo Producto</h2>
        <form action="{% url 'inbound' %}" method="POST">
            {% csrf_token %}

            <div class="grid gap-4 sm:grid-cols-2 sm:gap-6">
                <!-- <div>
                    <label for="productname" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{form.product.label_tag}}</label>
                      <<select  name="productname" id="productname" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"> 
                      
                         <option value="Seleccionar Producto" selected="selected"></option> 
                    </select> 
                    {{form.product}} 
                    </div> -->
                <div class="w-full">
                    <label for="brand" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Depósito</label>
                    {{form.warehouse}}
                    <!-- <input type="date" name="date" id="date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Ingresar Fecha" required="">
                     -->
                       
                    </div>
                <!-- <div class="w-full">
                    <label for="price" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Código de Barras</label>
                     <input type="number" name="barcode" id="barcode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="$2999" required=""> 
                       
                </div> -->
                <div>
                    <label for="motivoIngreso" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Motivo Ingreso</label>
                    {{form.motivoIngreso}}
                </div>
                <!-- <div>
                    <label for="item-weight" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Código Interno</label>
                     <input type="number" name="internal-code" id="internal-code" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="12" required=""> 
                 
                </div>  -->

                <div>
                    <label for="receptor" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Receptor</label>
                    {{form.receptor}}

                   
                </div>

            </div>
<!-- 
                
                <div class="flex">
                    <div class="block">
                    <label for="cantidad" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cantidad</label>
                    {{form.cantidad}}
                </div>
                   
                

                <div class="block">
                    <label for="cantidad-neta" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cantidad Neta</label>
                    {{form.cantidadNeta}}
                </div>
                   
                </div>

                <div>
                    <label for="receptor" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Subir Imágen</label>
                    {{form.image}}

                   
                </div> -->
                
            <div class="max-w-4xl mt-10">
            <table id="productTable" class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col-span-2" class="px-6 py-3">
                            Producto
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Código de Barras                    
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Código Interno
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Cantidad
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                         
                           
                             <label for="productname" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"></label>
                            <input type="text" id="productname"  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="John" required> 
                            <input type="hidden" id="product_id">
                        
                        </th>
                        <td class="px-6 py-4">
                            <input type="text" id="barcode" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="John" required>
                        </td>
                        <td class="px-6 py-4">
                            <input type="text" id="internal-code" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="John" required>
                        </td>
                        <td class="px-6 py-4">
                            {{form.cantidad}}
                        </td>

                        

                    </tr>
                 
                </tbody>
                <td class="px-6 py-4">
                    <button  id="btnAdd" class="inline-flex items-center px-3 py-1.5 mt-2 sm:mt-6 text-sm font-medium text-center text-white bg-primary-700 rounded-lg focus:ring-4 focus:ring-primary-200 dark:focus:ring-primary-900 hover:bg-primary-800">
                        Add New Product
                     </button>
                </td>
            </table>
        </div>

                
        <div class="sm:col-span-2">
            <label for="description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Observaciones</label>
            <textarea id="description" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Your description here"></textarea>
        
        </div>
            
            
            <button type="submit" class="inline-flex items-center px-5 py-2.5 mt-4 sm:mt-6 text-sm font-medium text-center text-white bg-primary-700 rounded-lg focus:ring-4 focus:ring-primary-200 dark:focus:ring-primary-900 hover:bg-primary-800">
                Confirma Ingreso
            </button>
        </div>
           
        </form>
    </div>

    {% if form.errors %}
    <div class="alert alert-danger">
        {{ form.errors }}
    </div>
{% endif %}

  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/datepicker.min.js"></script>


<script>


$('#btnAdd').click(function() {
  
    var name = $('<input class=bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500>').attr({ type: 'text', id: 'productname', name: 'name',
    class : "bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" 
})

    var barcode = $('<input class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">').attr({ type: 'text', id: 'barcode', name: 'barcode',
    class : "bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" })
         
    var internalCode = $('<input class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">').attr({ type: 'text', id: 'internalCode', name: 'internalcode',
    class : "bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" })
         
    var cantidad = $('<input class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">').attr({ type: 'text', id: 'cantidad', name: 'cantidad',
    class : "bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" })
         

    var markup = "<tr class=bg-white border-b dark:bg-gray-800 dark:border-gray-700><td class=px-6 py-4>" + name + "</td><td class=px-6 py-4>" + barcode + "</td><td class=px-6 py-4>" + internalCode + "</td><td class=px-6 py-4" +  cantidad + "</td></tr>";

    $("#productTable tbody").append(markup);
}
)


$(function () {

    $('#productname').autocomplete({
        source: '{% url "autocomplete-name" %}',
        minLength:1,
        select: function(event, ui) {
                     console.log(ui)
                 $('#productname').val(ui.item.value)
    }})
})



// $.ajax({
//             url: '{% url "products" %}',
//         type: 'get', 
//         success: function(data) {
//             console.log(data.products)

//             var names = 
//             $('#productname').autocomplete({
//                source:  data.products,
//                minLength: 1,
//                select: function(event, ui) {
//                     console.log(ui)
//                 $('#productname').val(ui.item.value)

//                }
                         
//               }
//             )
//             }

//             })
        




//     console.log('hola hola')
   $.ajax({
            url: `/products/`,
        type: 'get', 
        success: function(data) {
            console.log(data.products)

            console.log('llega aca')

            console.log(data.products)

            localStorage.setItem('products', JSON.stringify(data.products))
          //  for (let i = 0 ; i< data.products.length ; i++) {
               
          //  $("#productname").append(`<option value=${data.products[i][0]}>`+ data.products[i][1] +'</option>');

        }
    })
    
 $('#productname').change(function(){
     product = $(this).val();
     product_ = $('#productname').val()
     console.log(product_)
     console.log('product in front is:', product)

    var dataLS = JSON.parse(localStorage.getItem('products'))

    console.log('dataLS', dataLS)

    console.log('productSelected', dataLS[String(product)])

    var product = dataLS[product]
     request_url = '/product/' + product + '/';
         $.ajax({
             url: request_url,
             success: function(data){
                 let barcode = data.product[0][0]
                 let internalCode = data.product[0][1]
                 console.log(barcode)

                 console.log(internalCode)

                 $('#barcode').val(barcode)
                 $('#internal-code').val(internalCode)
    //             $('productname').attr('')
      
               }
            });
            
        })       




</script>

{% endblock content %}